<%- include('../partials/layout-protected-top', { title: 'Manage Subscription' }) %>

<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6 <%=TW_TEXT_COLOR_CLASS%>">Manage Subscription</h1>

    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h2 class="text-2xl font-semibold mb-4">Subscription Details</h2>
        <p><strong>Service:</strong> <%= subscription.service.name %></p>
        <p><strong>Start Date:</strong> <%= subscription.startDate.toLocaleDateString() %></p>
        <p><strong>End Date:</strong> <%= subscription.endDate.toLocaleDateString() %></p>
        <p><strong>Status:</strong> 
            <span class="<%= subscription.status === 'active' ? 'text-green-600' : 'text-red-600' %>">
                <%= subscription.status.charAt(0).toUpperCase() + subscription.status.slice(1) %>
            </span>
        </p>
      
        <% if (user && user.role === 'admin' && subscription.stripeMetadata) { %>
            <div class="mt-4">
                <h3 class="text-lg font-semibold mb-2">Stripe Metadata (Admin Only)</h3>
                <pre class="bg-gray-100 p-2 rounded overflow-x-auto"><%= JSON.stringify(subscription.stripeMetadata, null, 2) %></pre>
            </div>
        <% } %>
    </div>

    <% if (subscription.status === 'active') { %>
        <div class="bg-white shadow-md rounded-lg p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4">Cancel Subscription</h2>
            <p class="mb-4">Are you sure you want to cancel your subscription? This action cannot be undone.</p>
            <form action="/dashboard/subscription/<%= subscription._id %>/cancel" method="POST">
                <button type="submit" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Cancel Subscription
                </button>
            </form>
        </div>
    <% } else if (subscription.status === 'cancelled') { %>
        <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6" role="alert">
            <p class="font-bold">Subscription Cancelled</p>
            <p>Your subscription has been cancelled and will expire on <%= subscription.endDate.toLocaleDateString() %>.</p>
        </div>
    <% } else if (subscription.status === 'expired') { %>
        <div class="bg-gray-100 border-l-4 border-gray-500 text-gray-700 p-4 mb-6" role="alert">
            <p class="font-bold">Subscription Expired</p>
            <p>Your subscription has expired. If you wish to reactivate, please subscribe again.</p>
        </div>
    <% } %>

    <div class="mt-8">
        <a href="/dashboard/subscriptions" class="<%=TW_LINK_TEXT_COLOR_CLASS%> font-semibold">
            &larr; Back to Subscriptions
        </a>
    </div>
    <div class="mt-8">
        <a href="/dashboard" class="<%=TW_LINK_TEXT_COLOR_CLASS%> font-semibold">
            &larr; Back to Dashboard
        </a>
    </div>
</div>

<%- include('../partials/layout-public-bottom') %>